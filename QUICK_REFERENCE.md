# ğŸš€ Supabase Auth - ĞšÑ€Ğ°Ñ‚ĞºĞ¸Ğ¹ ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº

## ğŸ“± ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹

| Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° | URL | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|-----|----------|
| **Ğ’Ñ…Ğ¾Ğ´** | `/src/broker/login.html` | ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ |
| **Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ** | `/src/broker/register.html` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ² |
| **Dashboard** | `/src/broker/dashboard.html` | Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° (Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ°) |
| **Ğ¡Ğ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°** | `/src/broker/properties.html` | Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒÑ |
| **ĞŸĞ¾Ğ´Ğ±Ğ¾Ñ€ĞºĞ¸** | `/src/broker/selections.html` | ĞŸĞ¾Ğ´Ğ±Ğ¾Ñ€ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² |

---

## ğŸ” Flow Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯                               â”‚
â”‚                                                              â”‚
â”‚  register.html                                               â”‚
â”‚  â†“                                                           â”‚
â”‚  1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ñƒ                             â”‚
â”‚  2. SupabaseClient.signUp(email, password, metadata)         â”‚
â”‚  3. Supabase ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ user Ğ² auth.users                       â”‚
â”‚  4. Trigger ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² profiles                        â”‚
â”‚  5. Email Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)                         â”‚
â”‚  6. Redirect â†’ login.html                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ’Ğ¥ĞĞ”                                      â”‚
â”‚                                                              â”‚
â”‚  login.html                                                  â”‚
â”‚  â†“                                                           â”‚
â”‚  1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ²Ğ¾Ğ´Ğ¸Ñ‚ email Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ                       â”‚
â”‚  2. SupabaseClient.signIn(email, password)                   â”‚
â”‚  3. Supabase Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ credentials                           â”‚
â”‚  4. Ğ¢Ğ¾ĞºĞµĞ½ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² localStorage                         â”‚
â”‚  5. Redirect â†’ dashboard.html                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ—ĞĞ©Ğ˜Ğ¢Ğ Ğ¡Ğ¢Ğ ĞĞĞ˜Ğ¦                            â”‚
â”‚                                                              â”‚
â”‚  dashboard.html (Ğ»ÑĞ±Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°)                  â”‚
â”‚  â†“                                                           â”‚
â”‚  1. Page load â†’ checkAuth()                                  â”‚
â”‚  2. AuthHelper.requireAuth()                                 â”‚
â”‚  3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞµÑÑĞ¸Ğ¸ Ğ² Supabase                               â”‚
â”‚  4. Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ â†’ redirect to login.html                        â”‚
â”‚  5. Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ â†’ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ user info                          â”‚
â”‚  6. ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ’Ğ«Ğ¥ĞĞ”                                     â”‚
â”‚                                                              â”‚
â”‚  Ğ›ÑĞ±Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° â†’ Logout button                              â”‚
â”‚  â†“                                                           â”‚
â”‚  1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ Logout                             â”‚
â”‚  2. AuthHelper.logout() / SupabaseClient.signOut()           â”‚
â”‚  3. Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ¸Ğ· Supabase                              â”‚
â”‚  4. Redirect â†’ login.html                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ API

### SupabaseClient

```javascript
// ğŸ”‘ Ğ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯
await SupabaseClient.signUp('email@test.com', 'password123', {
  role: 'broker',
  name: 'John Doe',
  phone: '+357 99 123456'
});

// ğŸ”“ Ğ’Ğ¥ĞĞ”
await SupabaseClient.signIn('email@test.com', 'password123');

// ğŸšª Ğ’Ğ«Ğ¥ĞĞ”
await SupabaseClient.signOut();

// ğŸ‘¤ ĞŸĞĞ›Ğ£Ğ§Ğ˜Ğ¢Ğ¬ ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¯
const user = await SupabaseClient.getUser();
// { id, email, user_metadata, ... }

// ğŸ« ĞŸĞĞ›Ğ£Ğ§Ğ˜Ğ¢Ğ¬ Ğ¡Ğ•Ğ¡Ğ¡Ğ˜Ğ®
const session = await SupabaseClient.getSession();
// { access_token, refresh_token, user, ... }

// âœ… ĞŸĞ ĞĞ’Ğ•Ğ Ğ˜Ğ¢Ğ¬ ĞĞ’Ğ¢ĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ®
const isAuth = await SupabaseClient.isAuthenticated();
// true / false

// ğŸ­ ĞŸĞĞ›Ğ£Ğ§Ğ˜Ğ¢Ğ¬ Ğ ĞĞ›Ğ¬
const role = await SupabaseClient.getUserRole();
// 'broker' / 'client' / 'admin'
```

### AuthHelper

```javascript
// ğŸ›¡ï¸ Ğ—ĞĞ©Ğ˜Ğ¢Ğ˜Ğ¢Ğ¬ Ğ¡Ğ¢Ğ ĞĞĞ˜Ğ¦Ğ£ (Ğ°Ğ²Ñ‚Ğ¾-Ñ€ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚ ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½)
await AuthHelper.requireAuth('login.html');

// ğŸ‘» Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ”Ğ›Ğ¯ Ğ“ĞĞ¡Ğ¢Ğ•Ğ™ (Ğ°Ğ²Ñ‚Ğ¾-Ñ€ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚ ĞµÑĞ»Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½)
await AuthHelper.requireGuest('dashboard.html');

// ğŸ‘‘ Ğ¢Ğ Ğ•Ğ‘ĞĞ’ĞĞ¢Ğ¬ Ğ ĞĞ›Ğ¬
await AuthHelper.requireRole('broker', 'login.html');

// ğŸ“‹ ĞŸĞĞ›Ğ£Ğ§Ğ˜Ğ¢Ğ¬ Ğ˜ĞĞ¤Ğ Ğ ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ•
const userInfo = await AuthHelper.getCurrentUserInfo();
// { id, email, name, role, phone, createdAt }

// ğŸšª Ğ’Ğ«Ğ™Ğ¢Ğ˜ Ğ¡ ĞŸĞĞ”Ğ¢Ğ’Ğ•Ğ Ğ–Ğ”Ğ•ĞĞ˜Ğ•Ğœ
await AuthHelper.logout('Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹?');

// ğŸ“ ĞĞ‘Ğ ĞĞ‘ĞĞ¢ĞĞ¢Ğ¬ Ğ¤ĞĞ ĞœĞ£ Ğ’Ğ¥ĞĞ”Ğ
const result = await AuthHelper.handleLogin(email, password);
if (result.success) {
  // Ğ£ÑĞ¿ĞµÑ…
} else {
  alert(result.error);
}

// âœï¸ ĞĞ‘Ğ ĞĞ‘ĞĞ¢ĞĞ¢Ğ¬ Ğ¤ĞĞ ĞœĞ£ Ğ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ˜
const result = await AuthHelper.handleSignUp(email, password, metadata);
if (result.success) {
  // Ğ£ÑĞ¿ĞµÑ…
}
```

---

## ğŸ“ Ğ§ĞµĞº-Ğ»Ğ¸ÑÑ‚ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Supabase
- [ ] Email Provider Ğ²ĞºĞ»ÑÑ‡ĞµĞ½
- [ ] Email confirmation Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½ (Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸)
- [ ] SQL ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½
- [ ] Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° profiles ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°
- [ ] Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚
- [ ] RLS Ğ²ĞºĞ»ÑÑ‡ĞµĞ½

### âœ… Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ
- [ ] Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ
- [ ] ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ²Ğ²ĞµÑÑ‚Ğ¸ Ğ²ÑĞµ Ğ¿Ğ¾Ğ»Ñ
- [ ] Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
- [ ] ĞŸĞ°Ñ€Ğ¾Ğ»Ğ¸ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ÑÑ‚
- [ ] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ² auth.users
- [ ] ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ² profiles
- [ ] Redirect Ğ½Ğ° login Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

### âœ… Ğ’Ñ…Ğ¾Ğ´
- [ ] Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ
- [ ] ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ credentials
- [ ] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… credentials
- [ ] Redirect Ğ½Ğ° dashboard Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
- [ ] Ğ¢Ğ¾ĞºĞµĞ½ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ

### âœ… Dashboard
- [ ] Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ (redirect ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½)
- [ ] Ğ˜Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ÑÑ
- [ ] Ğ Ğ¾Ğ»ÑŒ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ÑÑ
- [ ] Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ÑÑ‚ÑÑ
- [ ] Logout Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

### âœ… Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†
- [ ] properties.html Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½
- [ ] selections.html Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½
- [ ] ĞĞµĞ»ÑŒĞ·Ñ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ±ĞµĞ· Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- [ ] ĞŸĞ¾ÑĞ»Ğµ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ²ÑĞµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

### âœ… Ğ¡ĞµÑÑĞ¸Ñ
- [ ] Ğ¡ĞµÑÑĞ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ
- [ ] Ğ¢Ğ¾ĞºĞµĞ½ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
- [ ] Logout ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ ÑĞµÑÑĞ¸Ñ
- [ ] Expired token Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ

---

## ğŸ¯ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

### Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ² ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸):
```javascript
await SupabaseClient.signUp('test@example.com', 'test123456', {
  role: 'broker',
  name: 'Test User'
});
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ:
```javascript
const user = await SupabaseClient.getUser();
console.log(user);
```

### ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞµÑÑĞ¸Ñ:
```javascript
await SupabaseClient.signOut();
localStorage.clear();
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:
```javascript
const isAuth = await SupabaseClient.isAuthenticated();
console.log('ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½:', isAuth);
```

---

## ğŸ—ƒï¸ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  auth.users (Supabase Auth)                             â”‚
â”‚  â”œâ”€ id (UUID)                                           â”‚
â”‚  â”œâ”€ email                                               â”‚
â”‚  â”œâ”€ encrypted_password                                  â”‚
â”‚  â””â”€ raw_user_meta_data (JSON: role, name, phone)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                      TRIGGER
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  public.profiles                                        â”‚
â”‚  â”œâ”€ id (UUID) â†’ FK to auth.users                        â”‚
â”‚  â”œâ”€ email                                               â”‚
â”‚  â”œâ”€ name                                                â”‚
â”‚  â”œâ”€ phone                                               â”‚
â”‚  â”œâ”€ role (broker/client/admin)                          â”‚
â”‚  â”œâ”€ avatar_url                                          â”‚
â”‚  â”œâ”€ company                                             â”‚
â”‚  â”œâ”€ created_at                                          â”‚
â”‚  â””â”€ updated_at                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Row Level Security (RLS)

```sql
-- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ²Ğ¸Ğ´ÑÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
CREATE POLICY "Users can read own profile" 
ON profiles FOR SELECT 
USING (auth.uid() = id);

-- Ğ‘Ñ€Ğ¾ĞºĞµÑ€Ñ‹ Ğ²Ğ¸Ğ´ÑÑ‚ Ğ²ÑĞµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸
CREATE POLICY "Brokers can view all profiles" 
ON profiles FOR SELECT 
USING (
  (SELECT role FROM profiles WHERE id = auth.uid()) = 'broker'
);

-- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ ÑĞ²Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
CREATE POLICY "Users can update own profile" 
ON profiles FOR UPDATE 
USING (auth.uid() = id);
```

---

## ğŸ†˜ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸

| ĞÑˆĞ¸Ğ±ĞºĞ° | ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° | Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ |
|--------|---------|---------|
| `User not found` | ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ | Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° |
| `Invalid credentials` | ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ email Ğ¸Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ | ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ |
| `Email not confirmed` | Email Ğ½Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½ | ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ confirmation Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ email |
| `Invalid API key` | ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ anonKey | ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ credentials |
| Redirect loop | ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ñ ÑĞµÑÑĞ¸ĞµĞ¹ | ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ localStorage |
| `403 Forbidden` | RLS Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ | ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ RLS |

---

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

- **ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ**: `docs/SUPABASE_AUTH_RU.md`
- **SQL Setup**: `supabase-setup.sql`
- **Supabase Docs**: https://supabase.com/docs/guides/auth
- **Troubleshooting**: Ğ¡Ğ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ² Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸

---

## âš¡ Pro Tips

1. **Ğ”Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸**: ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ email confirmation
2. **Ğ”Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸**: Ğ¡Ğ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ° (F12)
3. **Ğ”Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ**: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Incognito mode
4. **Ğ”Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸**: Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ HTTPS Ğ² Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğµ
5. **Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸**: ĞšÑÑˆĞ¸Ñ€ÑƒĞ¹Ñ‚Ğµ user info Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ

---

**Ğ’ĞµÑ€ÑĞ¸Ñ**: 1.0.0  
**Last Updated**: Ğ”ĞµĞºĞ°Ğ±Ñ€ÑŒ 2025
