# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Supabase - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-supabase)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
4. [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
5. [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
6. [–ó–∞—â–∏—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü](#–∑–∞—â–∏—Ç–∞-—Å—Ç—Ä–∞–Ω–∏—Ü)
7. [API Reference](#api-reference)
8. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

---

## –û–±–∑–æ—Ä

### –ß—Ç–æ –±—ã–ª–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ:

‚úÖ **Supabase Authentication** - –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –ë—Ä–æ–∫–µ—Ä—ã –∏ –∫–ª–∏–µ–Ω—Ç—ã
‚úÖ **–ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
‚úÖ **–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

### –í–∞—à–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Supabase:
```
URL: https://prgngcwhnehifzrsiktq.supabase.co
Anon Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByZ25nY3dobmVoaWZ6cnNpa3RxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMjEyODYsImV4cCI6MjA4MDU5NzI4Nn0.4sIeFKd7-r96hD2DzuUydajUktzuUCQcD1NKesbAVC0
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

### –®–∞–≥ 1: –í–∫–ª—é—á–µ–Ω–∏–µ Email Authentication

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å Supabase: https://app.supabase.com
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç: `airat88's Project`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Providers**
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **Email** –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤–∫–ª—é—á–µ–Ω
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã email:
   - ‚úÖ Enable Email Provider
   - ‚úÖ Confirm Email (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
   - ‚ö†Ô∏è –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–µ—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email Templates (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Email Templates** –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- –ü–∏—Å—å–º–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ü–∏—Å—å–º–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
- –ü–∏—Å—å–º–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è email

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ URL Redirects

–í **Authentication** ‚Üí **URL Configuration** –¥–æ–±–∞–≤—å—Ç–µ:
```
Site URL: https://–≤–∞—à-–¥–æ–º–µ–Ω.com
Redirect URLs:
  - https://–≤–∞—à-–¥–æ–º–µ–Ω.com/src/broker/dashboard.html
  - http://localhost:5500/src/broker/dashboard.html  (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
‚úÖ `favorites` - –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
‚úÖ `profiles` - –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚úÖ `properties` - –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `profiles`:

```sql
CREATE TABLE public.profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email TEXT NOT NULL,
  name TEXT,
  phone TEXT,
  role TEXT CHECK (role IN ('broker', 'client')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable Row Level Security
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
CREATE POLICY "Users can read own profile" 
  ON public.profiles FOR SELECT 
  USING (auth.uid() = id);

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
CREATE POLICY "Users can update own profile" 
  ON public.profiles FOR UPDATE 
  USING (auth.uid() = id);

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –ë—Ä–æ–∫–µ—Ä—ã –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
CREATE POLICY "Brokers can view client profiles" 
  ON public.profiles FOR SELECT 
  USING (
    auth.jwt() ->> 'role' = 'broker' 
    OR auth.uid() = id
  );
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```sql
-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
CREATE OR REPLACE FUNCTION public.handle_new_user() 
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, email, name, phone, role)
  VALUES (
    NEW.id,
    NEW.email,
    COALESCE(NEW.raw_user_meta_data->>'name', split_part(NEW.email, '@', 1)),
    NEW.raw_user_meta_data->>'phone',
    COALESCE(NEW.raw_user_meta_data->>'role', 'client')
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- –¢—Ä–∏–≥–≥–µ—Ä –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION public.handle_new_user();
```

---

## –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: `/src/broker/register.html`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –±—Ä–æ–∫–µ—Ä–æ–≤ –∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è email –∏ –ø–∞—Ä–æ–ª—è
- –í—ã–±–æ—Ä —Ä–æ–ª–∏ (broker/client)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/src/broker/register.html`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - –ò–º—è: `John Doe`
   - Email: `john@example.com`
   - –¢–µ–ª–µ—Ñ–æ–Ω: `+357 99 123456` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ü–∞—Ä–æ–ª—å: –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤
   - –†–æ–ª—å: Broker –∏–ª–∏ Client
3. –ù–∞–∂–º–∏—Ç–µ "Create Account"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:

```javascript
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±—Ä–æ–∫–µ—Ä–∞
const result = await AuthHelper.handleSignUp(
  'broker@example.com', 
  'securepassword123',
  {
    role: 'broker',
    name: 'Maria Konstantinou',
    phone: '+357 99 123456'
  }
);

if (result.success) {
  console.log('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', result.user);
} else {
  console.error('–û—à–∏–±–∫–∞:', result.error);
}
```

---

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞: `/src/broker/login.html`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –í—Ö–æ–¥ —Å email –∏ –ø–∞—Ä–æ–ª–µ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ dashboard –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ Supabase

**–ü—Ä–∏–º–µ—Ä –≤—Ö–æ–¥–∞:**
```javascript
// –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function login() {
  const result = await AuthHelper.handleLogin(
    'broker@example.com',
    'securepassword123'
  );
  
  if (result.success) {
    window.location.href = 'dashboard.html';
  } else {
    alert(result.error);
  }
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏:

```javascript
// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
const session = await SupabaseClient.getSession();
if (session) {
  console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', session.user.email);
}

// –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
const userInfo = await AuthHelper.getCurrentUserInfo();
console.log('–ò–º—è:', userInfo.name);
console.log('–†–æ–ª—å:', userInfo.role);
console.log('Email:', userInfo.email);
```

### –í—ã—Ö–æ–¥:

```javascript
// –í—ã—Ö–æ–¥ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
await AuthHelper.logout('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?');

// –ò–ª–∏ –ø—Ä—è–º–æ–π –≤—ã—Ö–æ–¥
await SupabaseClient.signOut();
window.location.href = 'login.html';
```

---

## –ó–∞—â–∏—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±—Ä–æ–∫–µ—Ä–∞ (`dashboard.html`, `properties.html`, `selections.html`) —Ç–µ–ø–µ—Ä—å –∑–∞—â–∏—â–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–ü—Ä–∏–º–µ—Ä –≤ dashboard.html:**
```javascript
async function checkAuth() {
  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ login –µ—Å–ª–∏ –Ω–µ—Ç
  const authenticated = await AuthHelper.requireAuth('login.html');
  if (!authenticated) return;
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userInfo = await AuthHelper.getCurrentUserInfo();
  // ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å userInfo –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
}
```

### –ó–∞—â–∏—Ç–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

```html
<!DOCTYPE html>
<html>
<head>
  <title>–ó–∞—â–∏—â–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
</head>
<body>
  <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
  
  <!-- –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../assets/js/supabase-client.js"></script>
  <script src="../assets/js/auth-helper.js"></script>
  
  <script>
    async function init() {
      // –ó–∞—â–∏—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      await AuthHelper.requireAuth();
      
      // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
      console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
    }
    
    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    init();
  </script>
</body>
</html>
```

### –ó–∞—â–∏—Ç–∞ –ø–æ —Ä–æ–ª–∏:

```javascript
// –¢–æ–ª—å–∫–æ –¥–ª—è –±—Ä–æ–∫–µ—Ä–æ–≤
async function checkBrokerAccess() {
  const hasAccess = await AuthHelper.requireRole('broker', 'login.html');
  if (!hasAccess) return;
  
  // –ö–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è –±—Ä–æ–∫–µ—Ä–æ–≤
  console.log('–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –±—Ä–æ–∫–µ—Ä–∞');
}
```

---

## API Reference

### SupabaseClient (supabase-client.js)

#### –ú–µ—Ç–æ–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

```javascript
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
await SupabaseClient.signUp(email, password, metadata)

// –í—Ö–æ–¥
await SupabaseClient.signIn(email, password)

// –í—ã—Ö–æ–¥
await SupabaseClient.signOut()

// –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é
const session = await SupabaseClient.getSession()

// –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = await SupabaseClient.getUser()

// –ü–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const userId = await SupabaseClient.getUserId()

// –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const role = await SupabaseClient.getUserRole()

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
const isAuth = await SupabaseClient.isAuthenticated()

// –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
await SupabaseClient.resetPassword(email)

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
await SupabaseClient.updatePassword(newPassword)

// –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
SupabaseClient.onAuthStateChange((event, session) => {
  console.log('Auth event:', event);
})
```

### AuthHelper (auth-helper.js)

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

```javascript
// –¢—Ä–µ–±–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –µ—Å–ª–∏ –Ω–µ—Ç)
await AuthHelper.requireAuth('login.html')

// –¢—Ä–µ–±–æ–≤–∞—Ç—å –≥–æ—Å—Ç—è (–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –µ—Å–ª–∏ –µ—Å—Ç—å —Å–µ—Å—Å–∏—è)
await AuthHelper.requireGuest('dashboard.html')

// –¢—Ä–µ–±–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ä–æ–ª—å
await AuthHelper.requireRole('broker', 'login.html')

// –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
const userInfo = await AuthHelper.getCurrentUserInfo()
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { id, email, name, role, phone, createdAt }

// –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥
const result = await AuthHelper.handleLogin(email, password)

// –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
const result = await AuthHelper.handleSignUp(email, password, metadata)

// –í—ã–π—Ç–∏ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
await AuthHelper.logout('–í—ã —É–≤–µ—Ä–µ–Ω—ã?')

// –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
await AuthHelper.displayUserInfo('elementId')

// –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª—É—à–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
AuthHelper.setupAuthListener()
```

---

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "User not found" –ø—Ä–∏ –≤—Ö–æ–¥–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –ª–∏ email (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ login

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—á–∏—Å—Ç–∏—Ç–µ localStorage: `localStorage.clear()`
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Supabase credentials –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

### –ü—Ä–æ–±–ª–µ–º–∞: Email –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Email Provider –≤ Supabase
2. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email:
   - Authentication ‚Üí Settings ‚Üí Enable email confirmations = OFF
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∞–º –ø–∞–ø–∫—É
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SMTP –≤ Supabase (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid API key"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `anonKey` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤ `supabase-client.js`
2. URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: `https://prgngcwhnehifzrsiktq.supabase.co`
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É

### –ü—Ä–æ–±–ª–µ–º–∞: RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor –≤ Supabase
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ RLS –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
3. –ò–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ RLS:
```sql
ALTER TABLE public.profiles DISABLE ROW LEVEL SECURITY;
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–π—Ç–µ trigger –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
2. –ò–ª–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –≤—Ä—É—á–Ω—É—é –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
```javascript
const { user } = await SupabaseClient.signUp(email, password, metadata);
if (user) {
  await SupabaseClient.client
    .from('profiles')
    .insert({
      id: user.id,
      email: user.email,
      name: metadata.name,
      role: metadata.role
    });
}
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

–û—Ç–∫—Ä–æ–π—Ç–µ `/src/broker/register.html` –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ:
```
Email: test@example.com
Password: test123456
Role: Broker
```

### 2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É:

–û—Ç–∫—Ä–æ–π—Ç–µ `/src/broker/login.html` –∏ –≤–æ–π–¥–∏—Ç–µ —Å —ç—Ç–∏–º–∏ credentials.

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ dashboard:

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ `/src/broker/dashboard.html` —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏ –≤ sidebar.

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã—Ö–æ–¥:

–ù–∞–∂–º–∏—Ç–µ "Logout" –≤ sidebar - –≤—ã –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### Password Reset Flow:

```javascript
// –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
await SupabaseClient.resetPassword('user@example.com');
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç email —Å —Å—Å—ã–ª–∫–æ–π

// –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ reset-password.html:
const newPassword = 'newpassword123';
await SupabaseClient.updatePassword(newPassword);
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è:

```javascript
// –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await SupabaseClient.client.auth.updateUser({
  data: { 
    name: 'New Name',
    phone: '+357 99 999999'
  }
});

// –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É profiles
await SupabaseClient.client
  .from('profiles')
  .update({ name: 'New Name', phone: '+357 99 999999' })
  .eq('id', userId);
```

### Real-time –ø–æ–¥–ø–∏—Å–∫–∏:

```javascript
// –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ profiles
const subscription = SupabaseClient.client
  .from('profiles')
  .on('UPDATE', payload => {
    console.log('Profile updated:', payload.new);
  })
  .subscribe();

// –û—Ç–ø–∏—Å–∞—Ç—å—Å—è
subscription.unsubscribe();
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Best Practices:

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `service_role` key –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ!**
2. –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π—Ç–µ Row Level Security (RLS)
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
4. –í–∫–ª—é—á–∏—Ç–µ email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)
6. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
7. –õ–æ–≥–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
8. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ rate limiting –¥–ª—è login endpoints

### –ü–æ–ª–∏—Ç–∏–∫–∏ RLS:

```sql
-- –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å
CREATE POLICY "Users own data" ON table_name
  USING (auth.uid() = user_id);

-- –ë—Ä–æ–∫–µ—Ä—ã –≤–∏–¥—è—Ç –≤—Å–µ
CREATE POLICY "Brokers see all" ON table_name
  USING (
    (SELECT role FROM profiles WHERE id = auth.uid()) = 'broker'
  );
```

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase logs –≤ –ø–∞–Ω–µ–ª–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ credentials –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ JavaScript —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Supabase:** https://supabase.com/docs/guides/auth

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** –î–µ–∫–∞–±—Ä—å 2025  
**–ê–≤—Ç–æ—Ä:** –°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é Claude
